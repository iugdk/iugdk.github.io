<!DOCTYPE html>
<html>
<head>

	<title>Quick Start - Leaflet</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

	<link rel="stylesheet" href="./Leaflet/leaflet.css" />
	<script src="./Leaflet/leaflet.js"></script>

	<script src="./jquery_3.1.1/jquery-3.1.1.min.js"></script>

	<script src='./Leaflet.markercluster-1.0.0/dist/leaflet.markercluster-src.js'></script>
	<link href='./Leaflet.markercluster-1.0.0/dist/MarkerCluster.css' rel='stylesheet' />
	<link href='./Leaflet.markercluster-1.0.0/dist/MarkerCluster.Default.css' rel='stylesheet' />


	<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
	<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />


	<script src='./Button/easy-button.js'></script>
	<link href='./Button/easy-button.css' rel='stylesheet' />

</head>

<body>



<div id="mapid" style="width: 700px; height: 450px;"></div>
<script>
/* eslint-disable */
var map = L.map('mapid').setView([50.370, -4.14], 3);
map.addControl(new L.Control.Fullscreen({
  position: 'topleft', // change the position of the button can be topleft, topright, bottomright or bottomleft, defaut topleft
  title: 'Show me the fullscreen !', // change the title of the button, default Full Screen
  titleCancel: 'Exit fullscreen mode', // change the title of the button when fullscreen is on, default Exit Full Screen
  content: null, // change the content of the button, can be HTML, default null
  forceSeparateButton: true, // force seperate button to detach from zoom buttons, default false
  forcePseudoFullscreen: true, // force use of pseudo full screen even if full screen API is available, default false
  fullscreenElement: false // Dom element to render in full screen, false by default, fallback to map._container
}));

var basemap = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: '&copy; <a href="http://IUG.dk">Engineers Without Borders, OpenStreetMap Contributors</a>'
}).addTo(map);

var owsrootUrl = 'http://88.99.35.158:8080/geoserver/IUG_MAP/ows';

var defaultParameters = {
    service : 'WFS',
    version : '2.0',
    request : 'GetFeature',
    typeName : 'IUG_MAP:Projects',
    outputFormat : 'text/javascript',
    format_options : 'callback:getJson',
    SrsName : 'EPSG:4326'
};

var parameters = L.Util.extend(defaultParameters);
var URL = owsrootUrl + L.Util.getParamString(parameters);

var markersEnviron = L.markerClusterGroup({
	iconCreateFunction: function(cluster) {
	var childCount = cluster.getChildCount();
		return L.divIcon({className: 'Environicon clusterIcons', html: '<div><span>' + childCount + '</span></div>'});
	},
	polygonOptions: {
	opacity: 0,
	fillOpacity: 0
	}
});

var markersWASH = L.markerClusterGroup({
	iconCreateFunction: function(cluster) {
	var childCount = cluster.getChildCount();
		return L.divIcon({className: 'Washicon clusterIcons', html: '<div><span>' + childCount + '</span></div>'});
	},
	polygonOptions: {
	opacity: 0,
	fillOpacity: 0
	}
});

var markersTechnical = L.markerClusterGroup({
	iconCreateFunction: function(cluster) {
	var childCount = cluster.getChildCount();
		return L.divIcon({className: 'Technicalicon clusterIcons', html: '<div><span>' + childCount + '</span></div>'});
	},
	polygonOptions: {
	opacity: 0,
	fillOpacity: 0
	}
});

var markersBuilding = L.markerClusterGroup({
	iconCreateFunction: function(cluster) {
	var childCount = cluster.getChildCount();
		return L.divIcon({className: 'Buildingicon clusterIcons', html: '<div><span>' + childCount + '</span></div>'});
	},
	polygonOptions: {
	opacity: 0,
	fillOpacity: 0
	}
});

var WFSLayer = null;

var icons = {
  wash: L.icon({
      iconUrl: 'https://ewbdk.org/graphics/logo/H300.png',
      iconSize: [32, 32],
      iconAnchor: [22, 36],
      popupAnchor: [-3, -36],
  }),
  environ: L.icon({
      iconUrl: 'https://ewbdk.org/graphics/logo/E300.png',
      iconSize: [32, 32],
      iconAnchor: [22, 36],
      popupAnchor: [-3, -36],
  }),
  building: L.icon({
      iconUrl: 'https://ewbdk.org/graphics/logo/A300.png',
      iconSize: [32, 32],
      iconAnchor: [22, 36],
      popupAnchor: [-3, -36],
  }),
  technical: L.icon({
      iconUrl: 'https://ewbdk.org/graphics/logo/W300.png',
      iconSize: [32, 32],
      iconAnchor: [22, 36],
      popupAnchor: [-3, -36],
  })
}

var ajaxWASH = $.ajax({
    url : URL,
    dataType : 'jsonp',
    jsonpCallback : 'getJson',
    success: function(data) {
    var TECHNICALJSON = L.geoJSON(data, {
        filter: TechnicalFilter,
        pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: icons.technical}).on('click', function (layer) {
              var props = layer.target.feature.properties
              var popup = L.popup()
                .setLatLng(latlng)
                .setContent(`
                  <table>
                    <tr><td class="tableTitle">Project</td><td class="tableText">${props.ProjectName}</td></tr>
                    <tr><td class="tableTitle">Kategori</td><td class="tableText">${props.Category}</td></tr>
                    <tr><td class="tableTitle">Land</td><td class="tableText">${props.Country}</td></tr>
                    <tr><td class="tableTitle">Projectleder</td><td class="tableText">${props.IUGProjectManager}</td></tr>
                    <tr><td class="tableTitle">Partner</td><td class="tableText">${props.ProjectPartnerOrganisation}</td></tr>
                    <tr><td class="tableTitle">Link</td><td class="tableText"><a href="${props.link}" target="_blank">link</a></td></tr>
                  </table>
                  <div class="imgContainer"><img class="projectImage" src="http://iug.dk/templates/IUG_Template/images/top_logo01.gif"/></div>
                  `)
                .openOn(map);
            })
        }
    });
    var BUILDINGJSON = L.geoJSON(data, {
        filter: BuildingFilter,
        pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: icons.building}).on('click', function (layer) {
              var props = layer.target.feature.properties
              var popup = L.popup()
                .setLatLng(latlng)
                .setContent(`
                  <table>
                    <tr><td class="tableTitle">Project</td><td class="tableText">${props.ProjectName}</td></tr>
                    <tr><td class="tableTitle">Kategori</td><td class="tableText">${props.Category}</td></tr>
                    <tr><td class="tableTitle">Land</td><td class="tableText">${props.Country}</td></tr>
                    <tr><td class="tableTitle">Projectleder</td><td class="tableText">${props.IUGProjectManager}</td></tr>
                    <tr><td class="tableTitle">Partner</td><td class="tableText">${props.ProjectPartnerOrganisation}</td></tr>
                    <tr><td class="tableTitle">Link</td><td class="tableText"><a href="${props.link}" target="_blank">link</a></td></tr>
                  </table>
                  <div class="imgContainer"><img class="projectImage" src="http://iug.dk/templates/IUG_Template/images/top_logo01.gif"/></div>
                  `)
                .openOn(map);
            })
        }
    });
    var ENVIRONJSON = L.geoJSON(data, {
        filter: EnvironFilter,
        pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: icons.environ}).on('click', function (layer) {
              var props = layer.target.feature.properties
              var popup = L.popup()
                .setLatLng(latlng)
                .setContent(`
                  <table>
                    <tr><td class="tableTitle">Project</td><td class="tableText">${props.ProjectName}</td></tr>
                    <tr><td class="tableTitle">Kategori</td><td class="tableText">${props.Category}</td></tr>
                    <tr><td class="tableTitle">Land</td><td class="tableText">${props.Country}</td></tr>
                    <tr><td class="tableTitle">Projectleder</td><td class="tableText">${props.IUGProjectManager}</td></tr>
                    <tr><td class="tableTitle">Partner</td><td class="tableText">${props.ProjectPartnerOrganisation}</td></tr>
                    <tr><td class="tableTitle">Link</td><td class="tableText"><a href="${props.link}" target="_blank">link</a></td></tr>
                  </table>
                  <div class="imgContainer"><img class="projectImage" src="http://iug.dk/templates/IUG_Template/images/top_logo01.gif"/></div>
                  `)
                .openOn(map);
            })
        }
    });
    var WASHJSON = L.geoJSON(data, {
        filter: WASHFilter,
        pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: icons.wash}).on('click', function (layer) {
              var props = layer.target.feature.properties
              var popup = L.popup()
                .setLatLng(latlng)
                .setContent(`
                  <table>
                    <tr><td class="tableTitle">Project</td><td class="tableText">${props.ProjectName}</td></tr>
                    <tr><td class="tableTitle">Kategori</td><td class="tableText">${props.Category}</td></tr>
                    <tr><td class="tableTitle">Land</td><td class="tableText">${props.Country}</td></tr>
                    <tr><td class="tableTitle">Projectleder</td><td class="tableText">${props.IUGProjectManager}</td></tr>
                    <tr><td class="tableTitle">Partner</td><td class="tableText">${props.ProjectPartnerOrganisation}</td></tr>
                    <tr><td class="tableTitle">Link</td><td class="tableText"><a href="${props.link}" target="_blank">link</a></td></tr>
                  </table>
                  <div class="imgContainer"><img class="projectImage" src="http://iug.dk/templates/IUG_Template/images/top_logo01.gif"/></div>
                  `)
                .openOn(map);
            })
        }
    });


		//add layers
		markersWASH.addLayer(WASHJSON)
		//map.addLayer(markersWASH);
		markersTechnical.addLayer(TECHNICALJSON);
		//map.addLayer(markersTechnical);
		markersBuilding.addLayer(BUILDINGJSON);
		//map.addLayer(markersBuilding);
		markersEnviron.addLayer(ENVIRONJSON);
		//map.addLayer(markersEnviron);

		//button test


		function WASHFilter(feature) {
  if (feature.properties.Category === "Water and Sanitation") return true
}
		function TechnicalFilter(feature) {
  if (feature.properties.Category === "Technical Assistance") return true
}
		function BuildingFilter(feature) {
  if (feature.properties.Category === "Building") return true
}
		function EnvironFilter(feature) {
  if (feature.properties.Category === "Environment") return true
}


var buttons = {
  environ: L.easyButton({
  	position: 'topright',
    states: [{
      stateName: 'add-markers',
      icon: '<img alt="do this" src="https://ewbdk.org/graphics/logo/E300.png" height="40" width="40" align="middle" style="opacity:0.4"/>',
      title: 'add random markers',
      onClick: function(control) {
        map.addLayer(markersEnviron);
        control.state('remove-markers');
      }
    }, {
      icon: '<img alt="do this" src="https://ewbdk.org/graphics/logo/E300.png" height="40" width="40" align="middle"/>',
      stateName: 'remove-markers',
      onClick: function(control) {
        map.removeLayer(markersEnviron);
        control.state('add-markers');
      },
      title: 'remove markers'
    }]
  }),
  building: L.easyButton({
  	position: 'topright',
    states: [{
      stateName: 'add-markers',
      icon: '<img alt="do this" src="https://ewbdk.org/graphics/logo/A300.png" height="40" width="40" align="middle" style="opacity:0.4"/>',
      title: 'add random markers',
      onClick: function(control) {
        map.addLayer(markersBuilding);
        control.state('remove-markers');
      }
    }, {
      icon: '<img alt="do this" src="https://ewbdk.org/graphics/logo/A300.png" height="40" width="40" align="middle"/>',
      stateName: 'remove-markers',
      onClick: function(control) {
        map.removeLayer(markersBuilding);
        control.state('add-markers');
      },
      title: 'remove markers'
    }]
  }),
  wash: L.easyButton({
  	position: 'topright',
    states: [{
      stateName: 'add-markers',
      icon: '<img alt="do this" src="https://ewbdk.org/graphics/logo/H300.png" height="40" width="40" align="middle" style="opacity:0.4"/>',
      title: 'add random markers',
      onClick: function(control) {
        map.addLayer(markersWASH);
        control.state('remove-markers');
      }
    }, {
      icon: '<img alt="do this" src="https://ewbdk.org/graphics/logo/H300.png" height="40" width="40" align="middle"/>',
      stateName: 'remove-markers',
      onClick: function(control) {
        map.removeLayer(markersWASH);
        control.state('add-markers');
      },
      title: 'remove markers'
    }]
  }),
  technical: L.easyButton({
  	position: 'topright',
    states: [{
      stateName: 'add-markers',
      icon: '<img alt="do this" src="https://ewbdk.org/graphics/logo/W300.png" height="40" width="40" align="middle" style="opacity:0.4"/>',
      title: 'add random markers',
      onClick: function(control) {
        map.addLayer(markersTechnical);
        control.state('remove-markers');
      }
    }, {
      icon: '<img alt="do this" src="https://ewbdk.org/graphics/logo/W300.png" height="40" width="40" align="middle"/>',
      stateName: 'remove-markers',
      onClick: function(control) {
        map.removeLayer(markersTechnical);
        control.state('add-markers');
      },
      title: 'remove markers'
    }]
  })
}
// add the buttons. iterates over the buttons objects
for (var key in buttons) {
  if (buttons.hasOwnProperty(key)) {
    buttons[key].addTo(map)
  }
}

}});



</script>



</body>
</html>
